{
  "name": "KAPFLEX - Sonde de boues",
  "type": "UPLINK",
  "debugMode": true,
  "configuration": {
    "decoder": "/** Helper functions **/\r\n\r\nfunction decodeToString(payload) {\r\n    return String.fromCharCode.apply(String, payload);\r\n}\r\n\r\nfunction decodeToJson(payload) {\r\n    // covert payload to string.\r\n    var str = decodeToString(payload);\r\n\r\n    // parse string to JSON\r\n    var data = JSON.parse(str);\r\n    return data;\r\n}\r\n\r\nfunction dateToLocalUnixTimestamp(timestamp){\r\n    var dateInMilliseconds = timestamp*1000;\r\n    var localUnixTimeStamp = +new Date(dateInMilliseconds);\r\n    return localUnixTimeStamp;\r\n}\r\n\r\nfunction dateToLocalDate(timestamp){\r\n    var localUnixTimeStamp = dateToLocalUnixTimestamp(timestamp);\r\n    var localDate = timeConverter(localUnixTimeStamp);\r\n    return localDate;\r\n}\r\n\r\n// function timeConverter(UNIX_timestamp){\r\n//   var a = new Date(UNIX_timestamp);\r\n//   var months = ['Janvier','Févier','Mars','Avril','Mai','Juin','Juillet','Août','Septembre','Octobre','Novembre','Décembre'];\r\n//   var days = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];\r\n//   var year = a.getFullYear();\r\n//   var month = months[a.getMonth()];\r\n//   var day = days[a.getDay()];\r\n//   var date = a.getDate() < 10 ? '0' + a.getDate() : a.getDate();\r\n//   var hour = a.getHours() < 10 ? '0' + a.getHours() : a.getHours();\r\n//   var min = a.getMinutes() < 10 ? '0' + a.getMinutes() : a.getMinutes();\r\n//   var sec = a.getSeconds() < 10 ? '0' + a.getSeconds() : a.getSeconds();\r\n//   var time = day + ' ' + date + ' ' + month + ' ' + year + ' - ' + hour + ':' + min + ':' + sec ;\r\n//   return time;\r\n// }\r\n\r\nfunction timeConverter(UNIX_timestamp) {\r\n  var a = new Date(UNIX_timestamp);\r\n  var year = a.getFullYear();\r\n  var month = (a.getMonth() + 1) < 10 ? '0' + (a.getMonth() + 1) : (a.getMonth() + 1);\r\n  var date = a.getDate() < 10 ? '0' + a.getDate() : a.getDate();\r\n  var hour = a.getHours() < 10 ? '0' + a.getHours() : a.getHours();\r\n  var min = a.getMinutes() < 10 ? '0' + a.getMinutes() : a.getMinutes();\r\n  var sec = a.getSeconds() < 10 ? '0' + a.getSeconds() : a.getSeconds();\r\n//   var time = `${year}/${month}/${date} - ${hour}:${min}:${sec}`;\r\n  var time = year + '/' + month + '/' + date + ' - ' + hour + ':' + min + ':' + sec;\r\n  return time;\r\n}\r\n\r\nfunction createSignalValue(msgSignalValue) {\r\n    var signalValue = \"\";\r\n    if(msgSignalValue < -15) {\r\n        signalValue = \"1/3\";\r\n    } else if (msgSignalValue >= -15 && msgSignalValue < -12) {\r\n        signalValue = \"2/3\";\r\n    } else if (msgSignalValue >= -12) {\r\n        signalValue = \"3/3\";\r\n    }\r\n    return signalValue;\r\n}\r\n\r\nfunction timeConverter(UNIX_timestamp) {\r\n  var a = new Date(UNIX_timestamp);\r\n  var year = a.getFullYear();\r\n  var month = (a.getMonth() + 1) < 10 ? '0' + (a.getMonth() + 1) : (a.getMonth() + 1);\r\n  var date = a.getDate() < 10 ? '0' + a.getDate() : a.getDate();\r\n  var hour = a.getHours() < 10 ? '0' + a.getHours() : a.getHours();\r\n  var min = a.getMinutes() < 10 ? '0' + a.getMinutes() : a.getMinutes();\r\n  var sec = a.getSeconds() < 10 ? '0' + a.getSeconds() : a.getSeconds();\r\n//   var time = `${year}/${month}/${date} - ${hour}:${min}:${sec}`;\r\n  var time = year + '/' + month + '/' + date + ' - ' + hour + ':' + min + ':' + sec;\r\n  return time;\r\n}\r\n\r\n\r\nfunction createPayload(msg){\r\n    var newMsg = {\r\n        \"deviceName\": msg.Device_id,\r\n        \"deviceType\": \"Kapflex - Sonde de boues\",\r\n        \"attributes\": {\r\n            \"ts\": msg.Timestamp * 1000,\r\n            \"lastMessage\": timeConverter(msg.Timestamp * 1000),\r\n            \"probeId\": msg.Probe_id,\r\n            \"address\": msg.Address,\r\n            \"latitude\": msg.Latitude,\r\n            \"longitude\": msg.Longitude,\r\n            \"messageNum\": msg.messageNum,\r\n            \"battery\": msg.BatteryPercent,\r\n            \"error\": msg.Error\r\n        }\r\n    };\r\n    if(typeof(msg.MudHeight_mm) !== undefined) {\r\n        newMsg.attributes.mudHeightMm = msg.MudHeight_mm;\r\n        newMsg.telemetry = {\r\n            \"ts\": msg.Timestamp * 1000,\r\n            \"values\": {\r\n                \"mudHeightMm\": msg.MudHeight_mm\r\n            }\r\n        };\r\n    }\r\n    return newMsg;\r\n}\r\n\r\n/** Decoder **/\r\n\r\nvar data = decodeToJson(payload);\r\n\r\nvar result = createPayload(data);\r\n\r\nreturn result;",
    "encoder": null
  },
  "additionalInfo": {
    "description": ""
  }
}